import com.prezi.spaghetti.gradle.BundleModule
import com.prezi.spaghetti.gradle.ObfuscateBundle
import com.prezi.gradle.boxfish.NpmArtifactory

apply plugin: "boxfish-haxe"

configurations {
	obfuscateNpm
}

dependencies {
	obfuscateNpm group: "npm", name: "source-map", version: "0.1.33", ext: "zip"
}

spaghetti {
	platform "haxe"
}

haxe {
	targetPlatforms {
		js
	}
	include "prezi.graphics.text"
}

compileJs {
	flag "-debug"
}

sources {
	main {
		haxe {
			source.srcDir generateHeaders.outputDirectory
			builtBy generateHeaders
		}
	}
}

task bundleModule(type: BundleModule) {
	dependsOn compileJs
	inputFile compileJs.outputFile
}

task npmObfuscate(type: NpmArtifactory) {
	config configurations.obfuscateNpm
}

obfuscateJsModule {
	dependsOn npmObfuscate
}
