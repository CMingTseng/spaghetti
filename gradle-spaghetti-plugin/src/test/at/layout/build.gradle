import com.prezi.spaghetti.gradle.BundleModule
import com.prezi.spaghetti.gradle.Obfuscate
import com.prezi.spaghetti.gradle.GenerateModuleHeaders

apply plugin: "spaghetti"

spaghetti {
	platform "haxe"
	definition "Layout.module"
}

task generateHeaders(type: GenerateModuleHeaders) {
}

task compileHaxe(type: com.prezi.gradle.haxe.CompileHaxe) {
	dependsOn generateHeaders
	configuration configurations.modules
	targetPlatform "js"
	source generateHeaders.outputDirectory
	source "src"
	include "prezi.graphics.text"
}

task bundleModule(type: BundleModule) {
	dependsOn compileHaxe
	inputFile compileHaxe.outputFile
}

task obfuscate(type: Obfuscate) {
  dependsOn bundleModule
  inputFile bundleModule.jsModuleFile
  withClosure()
}

artifacts {
	archives(obfuscate.outputFile) {
		builtBy obfuscate
	}
	modules(obfuscate.outputFile) {
		builtBy obfuscate
	}
}

