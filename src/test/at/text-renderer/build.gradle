import com.prezi.gradle.spaghetti.GenerateModuleHeaders

evaluationDependsOn(':layout')

apply plugin: "spaghetti"

configurations {
	modules
}

dependencies {
	modules project(path: ":layout", configuration: "modules")
}

spaghetti {
	platform "haxe"
	configuration configurations.modules
	definition "TextRenderer.module"
}

task generateHeaders(type: GenerateModuleHeaders) {
	outputDirectory "$buildDir/haxe"
}

task compileHaxe(type: com.prezi.gradle.haxe.CompileHaxe) {
	dependsOn generateHeaders
	configuration configurations.modules
	targetPlatform "js"
	source generateHeaders.outputDirectory
	source "src"
	include "prezi.graphics.text"
	outputFile "${buildDir}/module.js"
}

task bundleModule(type: com.prezi.gradle.spaghetti.BundleModule) {
	dependsOn compileHaxe
	inputFile compileHaxe.outputFile
	outputFile "${buildDir}/module.zip"
}

artifacts {
	archives(bundleModule.outputFile) {
		builtBy bundleModule
	}
	modules(bundleModule.outputFile) {
			builtBy bundleModule
	}
}
