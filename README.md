Spaghetti
=========

Spaghetti a tool for type-safe communication between JavaScript modules.

[![Build Status](https://travis-ci.org/prezi/spaghetti.svg)](https://travis-ci.org/prezi/spaghetti)
[![Analytics](https://ga-beacon.appspot.com/UA-54695510-1/github.com/prezi/spaghetti)](https://github.com/igrigorik/ga-beacon)

## Motivation

In JavaScript, modularizing a large, evolving application is hard, because the untyped nature of the modules makes it difficult to keep track of changing APIs. Spaghetti tries to remedy this situation by allowing compilers to check communication between modules. This way, instead of runtime problems, you can deal with compile-time errors.

## How Does it Work?

Spaghetti modules are written in compile-to-JS languages like [TypeScript](http://typescriptlang.org) and [Haxe](http://haxe.org). Each module has a [Spaghetti Interface Definition file](wiki/Spaghetti Syntax) that defines the module's API.

Spaghetti ensures type safety in the communication between modules in two ways:

* it generates interfaces and other types for you to implement in your chosen language to ensure that your module implements the right API,
* it generates proxies and other types in your chosen language to access dependent modules in a type-safe way.

This approach also allows modules to be written using different languages.

## Example

The definition of a Spaghetti module looks something like this:

```
module com.example.test as TestModule

/**
 * A tool to greet guests.
 */
interface Greeter {

    /**
     * Greets a guest and returns the greeting.
     */
    string sayHello(string guest)
}

/**
 * Creates a Greeter.
 */
Greeter createGreeter()
```

From the definition Spaghetti generates the language-specific types for the language of your choice (as long as it is TypeScript or Haxe for now). Here's how it looks like in Haxe:

```haxe
/* Generated by Spaghetti */
package com.example.test;

interface Greeter {
    /**
     * Greets a guest and returns the greeting.
     */
    function sayHello(guest:String):String;
}
```

You then create classes that implement the generated interfaces. You also need to create a "module class" that implements the static, module-level methods (`createGreeter()` in this case) defined in the Spaghetti definitino. In Haxe you would write the following:

```haxe
package com.example.test;

class TestModule {
    public static function createGreeter():Greeter {
        return new DefaultGreeter();
    }
}

class DefaultGreeter implements Greeter {
    public function sayHello(guest:String):String {
        return 'Hello ${guest}!';
    }
}
```

Once you have your module compiled into a single JS file, Spaghetti will bundle it into a ZIP file together with the module's definition. It is also possible to include resources (images, CSS etc.) in a module bundle that are accessible to the module's code.

When someone wants to use your module, they need to provide Spaghetti with the bundle you've created. Spaghetti then generates proxy classes to call your module in a type-safe way. To continue with the example, you could call your Haxe module from TypeScript via the generated proxy like this:

```typescript
var greeter = com.example.test.TestModule.createGreeter();
console.log(greeter.sayHello("World"));
```

Check out the working example under [spaghetti-gradle-example](spaghetti-gradle-example).

## Build System Support

### Command-Line Tool

You can use Spaghetti via a command-line tool. You can build it like this:

```bash
$ ./gradlew installApp
$ export PATH=`pwd`/spaghetti/build/install/spaghetti/bin:$PATH
```

It has a comprehensive help system (thanks to the awesome [Airline](https://github.com/airlift/airline) library):

```bash
$ spaghetti help
usage: spaghetti <command> [<args>]

The most commonly used spaghetti commands are:
    bundle     Create a module bundle.
    generate   Generate source code
    help       Display help information
    package    Package an application

See 'spaghetti help <command>' for more information on a specific command.
```

### Gradle

Spaghetti comes with a Gradle plugin that makes it easy to integrate Spaghetti into your workflow.

Read more about in the [plugin's readme](gradle-spaghetti-plugin/README.md).

### Other Systems

Maven support is planned, but no clear deadline is decided right now.
